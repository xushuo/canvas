<!doctype html>
<html class="no-js" lang="">
<head>
    <meta charset="utf-8">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <title>Canvas</title>
    <meta name="description" content="">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <link rel="stylesheet" href="css/main.css">
    <script src="js/vendor/modernizr-2.8.3.min.js"></script>
</head>
<body>

<canvas id="canvas" style="border: 1px solid silver;margin:50px auto;display: block">

</canvas>
<script>
    var WINDOW_WIDTH = 1024;
    var WINDOW_HEIGHT = 768;
    var RADIUS=8;
    var MARGIN_TOP = 60;
    var MARGIN_LEFT = 30;
    const endTime = new Date(2016,5,8,18,16,32);
    var curShowTimeSeconds = 0;

    window.onload = function () {
        var canvas = document.getElementById("canvas");
        canvas.width = WINDOW_WIDTH;
        canvas.height = WINDOW_HEIGHT;

        var context = canvas.getContext('2d');
        console.log(context);
        if (context) {
            /* context.beginPath();
             context.moveTo(100,100);
             context.lineTo(300,300);
             context.lineTo(200,500);
             context.lineTo(100,100);
             context.fillStyle="red";
             context.fill();
             context.closePath();

             context.beginPath();
             context.moveTo(700,700);
             context.lineTo(400,400);
             context.lineTo(100,800);
             context.lineTo(700,700);
             context.fillStyle="green";
             context.fill();
             context.closePath();*/

            /* context.beginPath();
             context.lineWidth=3;
             context.strokeStyle="red";
             context.arc(300,300,200,0,1.5*Math.PI,true);//300 300 圆心，200半径， 0到0.5pi;true逆时针
             context.closePath();//自动封闭路径
             context.stroke();

             context.fill();*/
            curShowTimeSeconds=getCurShowTimeSeconds();

            setInterval(function(){
                render(context);
                update();
            },50);

        } else {
            alert("该浏览器不支持canvas.");
        }

    }

    function update(){
        var nextShowTimeSeconds = getCurShowTimeSeconds();
        var nextHour=parseInt(nextShowTimeSeconds/3600);
        var nextMinutes=parseInt((nextShowTimeSeconds-nextHour*3600)/60);
        var nextSeconds=nextShowTimeSeconds%60;

        var curHour=parseInt(curShowTimeSeconds/3600);
        var curMinutes=parseInt((curShowTimeSeconds-curHour*3600)/60);
        var curSeconds=curShowTimeSeconds%60;

        if(nextSeconds!=curSeconds){
            curShowTimeSeconds=nextShowTimeSeconds;
        }
    }

    function getCurShowTimeSeconds(){
        var curTime = new Date();
        var ret = endTime.getTime()-curTime.getTime();
        console.log(ret);
        ret = Math.round(ret/1000);
        return ret>=0?ret:0;
    }

    function render(cxt) {

        cxt.clearRect(0,0,WINDOW_WIDTH,WINDOW_HEIGHT);//刷新

        var hour=parseInt(curShowTimeSeconds/3600);
        var minutes=parseInt((curShowTimeSeconds-hour*3600)/60);
        var seconds=curShowTimeSeconds%60;

        renderDigit(MARGIN_LEFT,MARGIN_TOP,parseInt(hour/10),cxt);
        renderDigit(MARGIN_LEFT+15*(RADIUS+1),MARGIN_TOP,parseInt(hour%10),cxt);

        renderDigit(MARGIN_LEFT+30*(RADIUS+1),MARGIN_TOP,10,cxt);

        renderDigit(MARGIN_LEFT+39*(RADIUS+1),MARGIN_TOP,parseInt(minutes/10),cxt);
        renderDigit(MARGIN_LEFT+54*(RADIUS+1),MARGIN_TOP,parseInt(minutes%10),cxt);

        renderDigit(MARGIN_LEFT+69*(RADIUS+1),MARGIN_TOP,10,cxt);

        renderDigit(MARGIN_LEFT+78*(RADIUS+1),MARGIN_TOP,parseInt(seconds/10),cxt);
        renderDigit(MARGIN_LEFT+93*(RADIUS+1),MARGIN_TOP,parseInt(seconds%10),cxt);

        /*renderDigit(260,50,10,cxt);

        renderDigit(340,50,parseInt(minutes/10),cxt);
        renderDigit(480,50,parseInt(minutes%10),cxt);

        renderDigit(600,50,10,cxt);

        renderDigit(680,50,parseInt(seconds/10),cxt);
        renderDigit(820,50,parseInt(seconds%10),cxt);*/

    }
    function renderDigit(x,y,num,cxt){
        cxt.fillStyle="blue";
        for(var i=0;i<digit[num].length; i++){
            for(var j=0; j<digit[num][i].length; j++){
                //console.log(digit[num][i][j]);
                if(digit[num][i][j]==1){
                    cxt.beginPath();
                    /*cxt.arc(x+(16*(j+1)),y+(16*(i+1)),7,0,2*Math.PI);*/
                    cxt.arc(x+j*2*(RADIUS+1)+(RADIUS+1),y+i*2*(RADIUS+1)+(RADIUS+1),RADIUS,0,2*Math.PI);
                    cxt.closePath();
                    cxt.fill();
                }else{

                }
            }
        }
    }


</script>

<script src="js/vendor/jquery-1.9.1.js"></script>
<script src="js/plugins.js"></script>
<script src="js/main.js"></script>
<script src="js/digit.js"></script>
</body>
</html>
